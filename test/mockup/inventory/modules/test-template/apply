#!/usr/bin/env bash

FILE="/tmp/$(basename ${0%/*})-$$"

cat > ${FILE} <<EOF
Testing templating!
Printing all variables available, via template
-------------------
Printing host variables:
{{- range $k, $v := .Mango.HostVars }}
{{ $k }}: {{ $v }}
{{- end }}
-------------------
Printing module variables:
{{- range $k, $v := .Mango.ModuleVars }}
{{ $k }}: {{ $v }}
{{- end }}
-------------------
Printing all variables (merged, where module variables override host variables):
{{- range $k, $v := .Mango.Vars }}
{{ $k }}: {{ $v }}
{{- end }}
-------------------
Printing all Mango runtime metadata:
Enrollment status: {{ .Mango.Metadata.Enrolled }}
Run ID: {{ .Mango.Metadata.RunID }}
Manager Name: {{ .Mango.Metadata.ManagerName }}
Inventory Path: {{ .Mango.Metadata.InventoryPath }}
Hostname: {{ .Mango.Metadata.Hostname }}
-------------------
Printing all OS metadata:
{{- range $k, $v := .Mango.OS.OSRelease }}
{{ $k }}: {{ $v }}
{{- end }}
-------------------
Printing all kernel metadata:
Kernel: {{ .Mango.Kernel.Kernel }}
Major: {{ .Mango.Kernel.Major }}
Minor: {{ .Mango.Kernel.Minor }}
Flavor: {{ .Mango.Kernel.Flavor }}
-------------------
Testing template functions:
Private IP: {{ sockaddr_GetPrivateIP }}
Public IP: {{ sockaddr_GetPublicIP }}
Interfaces: {{ sockaddr_GetAllInterfaces }}
More complex sockaddr template:
{{ with $ifAddrs := sockaddr_GetAllInterfaces | sockaddr_include "type" "ipv6" | sockaddr_include "flags" "forwardable" | sockaddr_exclude "flags" "loopback" | sockaddr_sort "+address" -}}
  {{- range $ifAddrs }}
    {{ sockaddr_attr "address" . }}
  {{- end -}}
{{- end }}
Done.
EOF
